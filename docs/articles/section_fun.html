<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sectioning a function • doBy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sectioning a function">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">doBy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.7.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/doby.html">doby: Groupwise computations and miscellaneous utilities</a>
    </li>
    <li>
      <a href="../articles/pipe-arithmetic.html">Pipe-friendly Arithmetic Helpers in doBy</a>
    </li>
    <li>
      <a href="../articles/section_fun.html">Sectioning a function</a>
    </li>
    <li>
      <a href="../articles/vtools.html">Working with vtools: Flexible Variable Selection</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hojsgaard/doBy/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sectioning a function</h1>
                        <h4 data-toc-skip class="author">Søren
Højsgaard</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hojsgaard/doBy/blob/HEAD/vignettes/section_fun.Rmd" class="external-link"><code>vignettes/section_fun.Rmd</code></a></small>
      <div class="hidden name"><code>section_fun.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="section-a-functions-domain-with-section_fun">Section a functions domain: with <code>section_fun()</code><a class="anchor" aria-label="anchor" href="#section-a-functions-domain-with-section_fun"></a>
</h2>
<p>The function <code>section_fun</code> is used to create a new
function that is a section of the original function. The section is
defined by fixing some of the arguments of the original function. The
new function is defined on the remaining arguments.</p>
<p>For example, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>x</mi><mo>+</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">f(x,y)=x+y</annotation></semantics></math>.
Then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>10</mn><mo>,</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_x(y)=f(10, y)</annotation></semantics></math>
is a section of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
to be a function of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
alone.</p>
<p>More generally, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
be a subset of the cartesian product
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>×</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X \times Y</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
are some sets. Consider a function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(x,y)</annotation></semantics></math>
defined on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>.
Then for any
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">x \in X</annotation></semantics></math>,
the section of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
defined by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
(denoted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>E</mi><mi>x</mi></msub><annotation encoding="application/x-tex">E_x</annotation></semantics></math>)
is the set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>’s
in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math>
is in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>,
i.e.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>x</mi></msub><mo>=</mo><mo stretchy="false" form="prefix">{</mo><mi>y</mi><mo>∈</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>∈</mo><mi>E</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">
 E_x = \{ y \in Y | (x,y) \in E\}
</annotation></semantics></math></p>
<p>Correspondingly, the section of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(x,y)</annotation></semantics></math>
defined by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
is the function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mi>x</mi></msub><annotation encoding="application/x-tex">f_x</annotation></semantics></math>
defined on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>E</mi><mi>x</mi></msub><annotation encoding="application/x-tex">E_x</annotation></semantics></math>
given by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_x(y)=f(x,y)</annotation></semantics></math>.</p>
</div>
<div class="section level2">
<h2 id="the-section_fun-function-in-doby">The <code>section_fun</code> function in <code>doBy</code><a class="anchor" aria-label="anchor" href="#the-section_fun-function-in-doby"></a>
</h2>
<p>The function <code>section_fun</code> is used to create a new
function that is a section of the original function. The section is
defined by fixing some of the arguments of the original function. The
new function is defined on the remaining arguments. There are the
following approaches:</p>
<ol style="list-style-type: decimal">
<li>insert the section values as default values in the function
definition (default),</li>
<li>insert the section values in the function body,</li>
<li>store the section values in an auxillary environment.</li>
</ol>
<p>Consider this function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun</span>  <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">=</span><span class="fl">4</span>, <span class="va">d</span><span class="op">=</span><span class="fl">9</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">a</span> <span class="op">+</span> <span class="va">b</span> <span class="op">+</span> <span class="va">c</span> <span class="op">+</span> <span class="va">d</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/section_fun.html">section_fun</a></span><span class="op">(</span><span class="va">fun</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="fl">7</span>, d<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fun_def</span></span>
<span><span class="co">#&gt; function (a, c = 4, b = 7, d = 10) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     a + b + c + d</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="va">fun_body</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/section_fun.html">section_fun</a></span><span class="op">(</span><span class="va">fun</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="fl">7</span>, d<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"sub"</span><span class="op">)</span></span>
<span><span class="va">fun_body</span></span>
<span><span class="co">#&gt; function (a, c = 4) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     b = 7</span></span>
<span><span class="co">#&gt;     d = 10</span></span>
<span><span class="co">#&gt;     a + b + c + d</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="va">fun_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/section_fun.html">section_fun</a></span><span class="op">(</span><span class="va">fun</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="fl">7</span>, d<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"env"</span><span class="op">)</span></span>
<span><span class="va">fun_env</span></span>
<span><span class="co">#&gt; function (a, c = 4) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     . &lt;- "use get_section(function_name) to see section"</span></span>
<span><span class="co">#&gt;     . &lt;- "use get_fun(function_name) to see original function"</span></span>
<span><span class="co">#&gt;     args &lt;- arg_getter()</span></span>
<span><span class="co">#&gt;     do.call(fun, args)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;environment: 0x5752bd3201f8&gt;</span></span></code></pre></div>
<p>In the last case, we can see the section and the original function
definition as:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/section_fun.html">get_section</a></span><span class="op">(</span><span class="va">fun_env</span><span class="op">)</span> </span>
<span><span class="co">#&gt; $b</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $d</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">## same as: attr(fun_env, "arg_env")$args </span></span>
<span><span class="fu"><a href="../reference/section_fun.html">get_fun</a></span><span class="op">(</span><span class="va">fun_env</span><span class="op">)</span> </span>
<span><span class="co">#&gt; &lt;srcref: file "" chars 1:9 to 3:1&gt;</span></span>
<span><span class="co">## same as: environment(fun_env)$fun</span></span></code></pre></div>
<p>We get:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fun</span><span class="op">(</span>a<span class="op">=</span><span class="fl">10</span>, b<span class="op">=</span><span class="fl">7</span>, c<span class="op">=</span><span class="fl">5</span>, d<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 32</span></span>
<span><span class="fu">fun_def</span><span class="op">(</span>a<span class="op">=</span><span class="fl">10</span>, c<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 32</span></span>
<span><span class="fu">fun_body</span><span class="op">(</span>a<span class="op">=</span><span class="fl">10</span>, c<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 32</span></span>
<span><span class="fu">fun_env</span><span class="op">(</span>a<span class="op">=</span><span class="fl">10</span>, c<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 32</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-benchmarking">Example: benchmarking<a class="anchor" aria-label="anchor" href="#example-benchmarking"></a>
</h2>
<p>Consider a simple task: Creating and inverting Toeplitz matrices for
increasing dimensions:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/toeplitz.html" class="external-link">toeplitz</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    1    2    3    4</span></span>
<span><span class="co">#&gt; [2,]    2    1    2    3</span></span>
<span><span class="co">#&gt; [3,]    3    2    1    2</span></span>
<span><span class="co">#&gt; [4,]    4    3    2    1</span></span></code></pre></div>
<p>An implementation is</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inv_toep</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/toeplitz.html" class="external-link">toeplitz</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">inv_toep</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,] -0.4  0.5  0.0  0.1</span></span>
<span><span class="co">#&gt; [2,]  0.5 -1.0  0.5  0.0</span></span>
<span><span class="co">#&gt; [3,]  0.0  0.5 -1.0  0.5</span></span>
<span><span class="co">#&gt; [4,]  0.1  0.0  0.5 -0.4</span></span></code></pre></div>
<p>We can benchmark timing for different values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
as</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>    <span class="fu">inv_toep</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="fu">inv_toep</span><span class="op">(</span><span class="fl">8</span><span class="op">)</span>, <span class="fu">inv_toep</span><span class="op">(</span><span class="fl">16</span><span class="op">)</span>,</span>
<span>    <span class="fu">inv_toep</span><span class="op">(</span><span class="fl">32</span><span class="op">)</span>, <span class="fu">inv_toep</span><span class="op">(</span><span class="fl">64</span><span class="op">)</span>,</span>
<span>    times<span class="op">=</span><span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: microseconds</span></span>
<span><span class="co">#&gt;          expr    min     lq   mean median     uq    max neval cld</span></span>
<span><span class="co">#&gt;   inv_toep(4)   8.60   8.69   8.95   8.71   9.04   9.73     5   a</span></span>
<span><span class="co">#&gt;   inv_toep(8)   9.68   9.68  11.04  10.88  11.29  13.70     5   a</span></span>
<span><span class="co">#&gt;  inv_toep(16)  15.37  16.18 187.16  16.47  20.46 867.30     5   a</span></span>
<span><span class="co">#&gt;  inv_toep(32)  34.89  35.01  35.21  35.22  35.34  35.58     5   a</span></span>
<span><span class="co">#&gt;  inv_toep(64) 114.33 115.22 116.86 117.72 117.88 119.18     5   a</span></span></code></pre></div>
<p>However, it is tedious (and hence error prone) to write these
function calls.</p>
<p>A programmatic approach using is as follows: First create a list of
sectioned functions:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n.vec</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">fun_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n.vec</span>,</span>
<span>                  <span class="kw">function</span><span class="op">(</span><span class="va">ni</span><span class="op">)</span><span class="op">{</span></span>
<span>                      <span class="fu"><a href="../reference/section_fun.html">section_fun</a></span><span class="op">(</span><span class="va">inv_toep</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">ni</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span>                  <span class="op">)</span></span></code></pre></div>
<p>We can inspect and evaluate each / all functions as:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; function (n = 3) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     solve(toeplitz(1:n))</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="va">fun_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        [,1] [,2]   [,3]</span></span>
<span><span class="co">#&gt; [1,] -0.375  0.5  0.125</span></span>
<span><span class="co">#&gt; [2,]  0.500 -1.0  0.500</span></span>
<span><span class="co">#&gt; [3,]  0.125  0.5 -0.375</span></span></code></pre></div>
<p>To use the list of functions in connection with microbenchmark we
bquote all functions using</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bquote_list</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fnlist</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fnlist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="fu">.</span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We get:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bq_fun_list</span> <span class="op">&lt;-</span> <span class="fu">bquote_list</span><span class="op">(</span><span class="va">fun_list</span><span class="op">)</span></span>
<span><span class="va">bq_fun_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; (function (n = 3) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     solve(toeplitz(1:n))</span></span>
<span><span class="co">#&gt; })()</span></span>
<span><span class="co">## Evaluate one:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">bq_fun_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;        [,1] [,2]   [,3]</span></span>
<span><span class="co">#&gt; [1,] -0.375  0.5  0.125</span></span>
<span><span class="co">#&gt; [2,]  0.500 -1.0  0.500</span></span>
<span><span class="co">#&gt; [3,]  0.125  0.5 -0.375</span></span>
<span><span class="co">## Evaluate all:</span></span>
<span><span class="co">## lapply(bq_fun_list, eval)</span></span></code></pre></div>
<p>To use microbenchmark we must name the elements of the list:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bq_fun_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">n.vec</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  list  <span class="op">=</span> <span class="va">bq_fun_list</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: microseconds</span></span>
<span><span class="co">#&gt;  expr  min   lq  mean median    uq   max neval cld</span></span>
<span><span class="co">#&gt;     3 8.34 8.36  8.90   9.01  9.11  9.66     5   a</span></span>
<span><span class="co">#&gt;     4 8.74 9.11  9.88   9.20  9.20 13.16     5   a</span></span>
<span><span class="co">#&gt;     5 9.19 9.47 24.69  15.48 16.48 72.83     5   a</span></span></code></pre></div>
<p>Running the code below provides a benchmark of the different ways of
sectioning in terms of speed.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n.vec</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">80</span>, by<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">fun_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n.vec</span>,</span>
<span>                  <span class="kw">function</span><span class="op">(</span><span class="va">ni</span><span class="op">)</span><span class="op">{</span></span>
<span>                      <span class="fu"><a href="../reference/section_fun.html">section_fun</a></span><span class="op">(</span><span class="va">inv_toep</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">ni</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"def"</span><span class="op">)</span><span class="op">}</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="va">fun_body</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n.vec</span>,</span>
<span>                  <span class="kw">function</span><span class="op">(</span><span class="va">ni</span><span class="op">)</span><span class="op">{</span></span>
<span>                      <span class="fu"><a href="../reference/section_fun.html">section_fun</a></span><span class="op">(</span><span class="va">inv_toep</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">ni</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"sub"</span><span class="op">)</span><span class="op">}</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="va">fun_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n.vec</span>,</span>
<span>                  <span class="kw">function</span><span class="op">(</span><span class="va">ni</span><span class="op">)</span><span class="op">{</span></span>
<span>                      <span class="fu"><a href="../reference/section_fun.html">section_fun</a></span><span class="op">(</span><span class="va">inv_toep</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">ni</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"env"</span><span class="op">)</span><span class="op">}</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="va">bq_fun_list</span> <span class="op">&lt;-</span> <span class="fu">bquote_list</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fun_def</span>, <span class="va">fun_body</span>, <span class="va">fun_env</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bq_fun_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"def"</span>, <span class="st">"body"</span>, <span class="st">"env"</span><span class="op">)</span>, each<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">n.vec</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">n.vec</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  list  <span class="op">=</span> <span class="va">bq_fun_list</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ulrich Halekoh, Søren Højsgaard.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
